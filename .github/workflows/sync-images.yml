name: Sync Public Images to Huawei SWR

on:
  # æ‰‹åŠ¨è§¦å‘ï¼ˆç‚¹å‡» Actions é¡µé¢çš„ "Run workflow"ï¼‰
  workflow_dispatch:
  
  # æ¯å¤© UTC æ—¶é—´å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´ 10:00ï¼‰
  schedule:
    - cron: '0 2 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Install skopeo
        run: |
          sudo apt update
          sudo apt install -y skopeo

      - name: Sync OpenJDK 17 JRE Slim
        run: |
          for attempt in {1..3}; do
            echo "Attempt $attempt..."
            if skopeo copy \
              --src-no-creds \
              --dest-creds "${{ secrets.HW_AK }}:${{ secrets.HW_SK }}" \
              docker://docker.io/eclipse-temurin:17-jre-alpine \
              docker://swr.cn-east-3.myhuaweicloud.com/wzy/temurin:17-jre-alpine; then
              echo "âœ… Sync succeeded!"
              exit 0
            else
              echo "âŒ Attempt $attempt failed. Retrying in 10 seconds..."
              sleep 10
            fi
          done
          echo "ğŸ’¥ All attempts failed!"
          exit 1

      # - name: Sync Nginx (example)
      #   run: |
      #     skopeo copy \
      #       --src-no-creds \
      #       --dest-creds "${{ secrets.HW_AK }}:${{ secrets.HW_SK }}" \
      #       docker://docker.io/library/nginx:alpine \
      #       docker://swr.cn-east-3.myhuaweicloud.com/wzy/nginx:alpine

      # ğŸ‘‡ åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šä½ è¦çš„é•œåƒ
